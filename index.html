<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>event_channel: event_channel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">event_channel
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceevent__channel.html" title="Encompasses everything related to event channel. ">event_channel</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#introduction">Introduction</a></li>
<li class="level1"><a href="#considerations">Technical considerations</a></li>
<li class="level1"><a href="#principles">Design principles</a><ul><li class="level2"><a href="#policies">Policy-based design</a><ul><li class="level3"><a href="#dispatch">Event dispatching policy</a></li>
<li class="level3"><a href="#idle">Idle policy</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#improvements">Future improvements</a></li>
<li class="level1"><a href="#sample">Sample code</a></li>
<li class="level1"><a href="#license">License</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p><a class="el" href="namespaceevent__channel.html">event_channel</a> is an exploration project of mine. After having used a handful of messaging frameworks that forced the user to wrap messages and message handlers in boilerplate code, I set on to discover whether this was strictly necessary. That is, can I come up with a framework that given a function <code>foo(int)</code>, can send an <code>int</code> to that function asynchronously without having to provide the framework a wrapped <code>foo(int)</code> and a wrapped <code>int</code>.</p>
<p>Here's an example of what I am trying to avoid:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">int</span>)</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Must wrap event data in some &quot;event&quot; class which itself must derive from some base &quot;event&quot; class.</span></div>
<div class="line"><span class="keyword">class </span>my_event : <span class="keyword">public</span> the_framework::event_base</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> data_;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Must wrap event handler in some handler functor which itself must derive from some base &quot;handler&quot; class.</span></div>
<div class="line"><span class="keyword">class </span>my_event_foo_handler : <span class="keyword">public</span> the_framework::event_handler_base&lt;my_event&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> operator()(my_event <span class="keyword">const</span>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        foo(e.data_);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">the_framework::dispatcher d;</div>
<div class="line"> </div>
<div class="line">my_event_foo_handler h;</div>
<div class="line">d.subscribe(h);</div>
<div class="line"> </div>
<div class="line">my_event e{22};</div>
<div class="line">d.send(e);  <span class="comment">// foo(22) is invoked on some other thread.</span></div>
</div><!-- fragment --><p>Depending on the framework in question, the wrapping code will be error-prone, tediously boilerplate or both.</p>
<p>The ideal scenario is this one:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">int</span>)</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line">the_framework::dispatcher d;</div>
<div class="line"></div>
<div class="line">d.subscribe(foo);</div>
<div class="line"></div>
<div class="line">d.send(22); <span class="comment">// foo(22) is invoked on some other thread.</span></div>
</div><!-- fragment --><p>Obvisouly, I can't restrict this framework to <code>int</code>s and global functions. This framework allows messages of any type and handlers of multiple nature (i.e. global functions, member functions and generic callables).</p>
<h1><a class="anchor" id="considerations"></a>
Technical considerations</h1>
<p>One of my goals with <a class="el" href="namespaceevent__channel.html">event_channel</a> was to learn and explore some new features of C++14. The first feature I used, albeit more as a convenience than a necessity, is <a href="https://en.wikipedia.org/wiki/C%2B%2B14#Lambda_capture_expressions">lambda capture</a>. The second feature used is <a href="http://en.cppreference.com/w/cpp/utility/integer_sequence">std::integer_sequence</a>. That feature is fundamental to <a class="el" href="namespaceevent__channel.html">event_channel</a> in that it helps us to invoke functions with parameters aggregated in a <a href="http://en.cppreference.com/w/cpp/utility/tuple">std::tuple</a>. This technique is described <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n3915.pdf">here</a>. Note that this technique may become standard and obviate the need for that private code in <a class="el" href="classevent__channel_1_1channel.html">event_channel::channel</a>.</p>
<p>This code compiles successfully with AppleClang 7.0.0, VC++ 14 and g++ 5.1.1.</p>
<h1><a class="anchor" id="principles"></a>
Design principles</h1>
<h2><a class="anchor" id="policies"></a>
Policy-based design</h2>
<p>Like other libraries of mine, I often follow principles of <a href="https://en.wikipedia.org/wiki/Policy-based_design">policy-based design</a>. <a class="el" href="classevent__channel_1_1channel.html">event_channel::channel</a> currently supports two policies.</p>
<h3><a class="anchor" id="dispatch"></a>
Event dispatching policy</h3>
<p>The first policy dictates how an event is processed. When <a class="el" href="classevent__channel_1_1channel.html">event_channel::channel</a> is instantiated with its dispatch policy set to <a class="el" href="structevent__channel_1_1dispatch__policy_1_1sequential.html">event_channel::dispatch_policy::sequential</a>, handlers for a given event will be invoked sequentially. On the other hand, when the dispatch policy is set to <a class="el" href="structevent__channel_1_1dispatch__policy_1_1parallel.html">event_channel::dispatch_policy::parallel</a>, handlers for a given event will be invoked simultaneously in parallel.</p>
<h3><a class="anchor" id="idle"></a>
Idle policy</h3>
<p>The second policy dictates what happens to events when the <a class="el" href="classevent__channel_1_1channel.html">event_channel::channel</a> is idle (e.g. hasn't been <a class="el" href="classevent__channel_1_1channel.html#ac6ce2c1b0e1d066f7edfb3dc359b8bf7">started</a> yet or has been <a class="el" href="classevent__channel_1_1channel.html#aef904f3c1a6254cd5894ff1621afe260">stopped</a>). When <a class="el" href="classevent__channel_1_1channel.html">event_channel::channel</a> is instantiated with its idle policy set to <a class="el" href="namespaceevent__channel_1_1idle__policy.html#af22cde2f3c8a7b1ff2165b92eda35e6f">event_channel::idle_policy::keep_events</a>, unprocessed and incoming events will kept in the queue and processed when the channel is restarted. Conversely, when the idle policy is set to <a class="el" href="namespaceevent__channel_1_1idle__policy.html#ae5980fa66305f21bbd94ce76893284a3">event_channel::idle_policy::drop_events</a>, unprocessed and incoming events will be discarded as long as the channel is idle.</p>
<h1><a class="anchor" id="improvements"></a>
Future improvements</h1>
<p>More test cases. More. More!</p>
<h1><a class="anchor" id="sample"></a>
Sample code</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="event__channel_8h.html">event_channel.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;typeinfo&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keywordtype">void</span> print_t(T t)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; __FUNCTION__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; t &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>widget</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> print_int(<span class="keywordtype">int</span> i)</div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __FUNCTION__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; i &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">    <span class="keywordtype">void</span> print_t(T t)</div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __FUNCTION__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; <span class="keyword">typeid</span>(T).name() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    map&lt;int, string&gt; mis;</div>
<div class="line">    mis[11] = <span class="stringliteral">&quot;apple&quot;</span>;</div>
<div class="line">    mis[22] = <span class="stringliteral">&quot;banana&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classevent__channel_1_1channel.html">event_channel::channel&lt;&gt;</a> ec;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Subscribe a global function.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a4f9cbbc23ded94c28d33193b5a179453">subscribe</a>(print_t&lt;int&gt;);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Publish an &#39;int&#39; event and sleep for a second.</span></div>
<div class="line">    <span class="comment">// We should observe the print statement from print_t&lt;int&gt;.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(1);</div>
<div class="line">    this_thread::sleep_for(chrono::seconds(1));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Subscribe two widgets, one stack-allocated and one heap-allocated through make_shared&lt;&gt;.</span></div>
<div class="line">    widget w1;</div>
<div class="line">    <span class="keyword">auto</span> w2 = make_shared&lt;widget&gt;();</div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a4f9cbbc23ded94c28d33193b5a179453">subscribe</a>(&amp;w1, &amp;widget::print_int);</div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a4f9cbbc23ded94c28d33193b5a179453">subscribe</a>(w2, &amp;widget::print_t&lt;double&gt;);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Publish an &#39;int&#39; event and a &#39;double&#39; event.</span></div>
<div class="line">    <span class="comment">// We should observe the print statements from print_t&lt;int&gt;, w1::print_int and w2::print_t&lt;double&gt;.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(2);</div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(33.3);</div>
<div class="line">    this_thread::sleep_for(chrono::seconds(1));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unsubscribe the second widget.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#af924eb6c30b13dcb9d6fc88e81d4066e">unsubscribe</a>(w2, &amp;widget::print_t&lt;double&gt;);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Publish an &#39;int&#39; event and a &#39;double&#39; event.</span></div>
<div class="line">    <span class="comment">// We should observe the print statements from print_t&lt;int&gt;, w1::print_int.</span></div>
<div class="line">    <span class="comment">// We should not observe the print statement from w2::print_t&lt;double&gt;.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(4);</div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(55.5);</div>
<div class="line">    this_thread::sleep_for(chrono::seconds(1));</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Subscribe a callable.</span></div>
<div class="line">    <span class="keyword">auto</span> simon_says = ([](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s){ cout &lt;&lt; <span class="stringliteral">&quot;Simon says: &quot;</span> &lt;&lt; s &lt;&lt; endl; });</div>
<div class="line">    <a class="code" href="namespaceevent__channel.html#a3b2a44cd87d6273f180f5132332e5a37">event_channel::handler_tag_t</a> tag1 = ec.<a class="code" href="classevent__channel_1_1channel.html#a4f9cbbc23ded94c28d33193b5a179453">subscribe</a>&lt;decltype(simon_says), <span class="keywordtype">string</span> <span class="keyword">const</span>&amp;&gt;(simon_says);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Send two strings.</span></div>
<div class="line">    <span class="comment">// We should observe the print statements from the simon_says lambda.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Touch your nose!&quot;</span>));</div>
<div class="line">    this_thread::sleep_for(chrono::seconds(1));</div>
<div class="line"></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Touch your chin!&quot;</span>));</div>
<div class="line">    this_thread::sleep_for(chrono::seconds(1));</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Unsubscribe the callable (via its tag).</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#af924eb6c30b13dcb9d6fc88e81d4066e">unsubscribe</a>(tag1);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Send a string.</span></div>
<div class="line">    <span class="comment">// We should not observe any print statement.</span></div>
<div class="line">    ec.<a class="code" href="classevent__channel_1_1channel.html#a024b00878afe067f971ca013601cb52b">send</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Touch your tail!&quot;</span>));</div>
<div class="line">    this_thread::sleep_for(chrono::seconds(1));</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// We&#39;re done.</span></div>
<div class="line">    <span class="comment">// Everything will be cleaned-up automatically.</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="license"></a>
License</h1>
<pre class="fragment">Boost Software License - Version 1.0 - August 17th, 2003

Permission is hereby granted, free of charge, to any person or organization
obtaining a copy of the software and accompanying documentation covered by
this license (the "Software") to use, reproduce, display, distribute,
execute, and transmit the Software, and to prepare derivative works of the
Software, and to permit third-parties to whom the Software is furnished to
do so, all subject to the following:

The copyright notices in the Software and this entire statement, including
the above license grant, this restriction and the following disclaimer,
must be included in all copies of the Software, in whole or in part, and
all derivative works of the Software, unless such copies or derivative
works are solely in the form of machine-executable object code generated by
a source language processor.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.
</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 30 2015 18:23:51 for event_channel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
